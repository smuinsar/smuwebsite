<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Add a GeoJSON polygon</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
<script src="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css" rel="stylesheet" />
<style>
	body { margin: 0; padding: 0; }
	#map { position: absolute; top: 0; bottom: 0; width: 100%; }
</style>
</head>
<body>

<!-- added by Jinwoo -->
<style>
#panel {
position: absolute;
background: #D3D3D3;
opacity: 0.7;
left: 5px;
top: 5px;
padding: 10px;
font-family: "Arial Black", Gadget, sans-serif;
}
</style>

<style>
#logopanel {
position: absolute;
bottom: 5px;
left: 5px;
padding: 0px;
font-family: "Times New Roman", Times, serif;
font-style: italic;
font-size: 10px;
}
</style>

<div id="map"></div>

<div id="panel">
<div>InSAR-based Landslide Inventory</div>
<div>over Pacific Northwest (ALOS/ALOS-2)</div>
</div>

<div id="logopanel">
<div><a href="https://www.smu.edu/radarlab"><img src="https://www.smu.edu/~/media/Site/DevelopmentExternalAffairs/MarketingCommunications/Logos/smu/SMUlogowWordmarkRBrgb" width="98px" height="32px"></a>
        <a href="https://www.nasa.gov"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e5/NASA_logo.svg/200px-NASA_logo.svg.png" width="40px" height="32px"></a></div>
<div>webpage created by Jinwoo</div>
</div>

<script>

var satellite = {
        'version': 8,
        'sources': {
          'raster-tiles': {
            'type': 'raster',
            'tiles': [
                    'https://basemap.nationalmap.gov/arcgis/rest/services/USGSImageryTopo/MapServer/tile/{z}/{y}/{x}'
                    //'http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'
            ],
            'tileSize': 256,
          }
        },
        'layers': [{
          'id': 'simple-tiles',
          'type': 'raster',
          'source': 'raster-tiles',
          'minzoom': 0,
          'maxzoom': 22
        }]
      }


var map = new mapboxgl.Map({
container: 'map',
style: satellite,
center: [-123.69,40.3],
zoom: 7
});

map.on('load', function () {
  map.addSource('landslide', {
    'type': 'geojson',
    'data': 'https://chowoon.github.io/files/ALOS_based_landslide_inventory.geojson',
    });

   map.addLayer({
	'id': 'landslide',
	'type': 'fill',
	'source': 'landslide',
	'layout': {},
	'paint': {
		'fill-color': '#FC3207',
		'fill-opacity': 0.6
		}
  });

  // Popups

            var popupAction = 'click',
            //var popupAction = 'mousemove',
                popupSettings =  {
                    closeButton: false,
                    closeOnClick: false
                };

  // Create a popup
  var popup = new mapboxgl.Popup(popupSettings);

  var hoveredStateId = 0;

  // Show the popup on mouseover
  map.on(popupAction, function(e) {
    var features = map.queryRenderedFeatures(e.point, {layers: ['landslide']});
	  
    if (features.length > 0) {
                map.getCanvas().style.cursor = 'pointer';
                var f = features[0];
                newHoveredStateId = f.id;

	    if (newHoveredStateId != hoveredStateId) {
                    map.removeFeatureState({source: 'landslide', id: hoveredStateId});

                    hoveredStateId = newHoveredStateId;
            }

	    map.setFeatureState({source: 'landslide', id: hoveredStateId}, { hover: true});

	    key1 = 'Name';
	    key2 = 'Area';
            key3 = 'Comments';
 
	    let popup_html = '<div><li><b> ' + key1 + '</b>: ' + f.properties[key1] + ' </li>';
		    popup_html += '<li><b> ' + key2 + ' </b> (m<sup>2</sup>): ' + f.properties[key2] +'</li>';
		     popup_html += '<li><b> ' + key3 + ' </b>: ' + f.properties[key3] +'</li>';
	    //popup_html += '<li><b>Location</b>: ' + f.geometry.coordinates[0].toPrecision(6) + ', ' + f.geometry.coordinates[1].toPrecision(6) + '</li>';
	    popup_html += '</div>';

	    popup.setLngLat(e.lngLat)
                    .setHTML(popup_html)
                    .addTo(map);
    }
	  else {
         	map.getCanvas().style.cursor = '';
                popup.remove();
                map.removeFeatureState({source: 'landslide', id: hoveredStateId});
	  }
   });


  });


  map.addControl(new mapboxgl.NavigationControl());	
	 
</script>
</body>
</html>


